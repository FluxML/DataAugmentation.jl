{"attributes":{"backlinks":[],"path":"/home/runner/.julia/packages/DataAugmentation/zwubD/docs/literate/buffering.md","title":"Buffering"},"tag":"document","children":[{"attributes":{},"tag":"md","children":[{"attributes":{},"tag":"h1","children":["Buffering"],"type":"node"},{"attributes":{},"tag":"p","children":["As mentioned in the section on ",{"attributes":{"reftype":"document","href":"./tfminterface.md","title":"","document_id":"documents/docs/literate/tfminterface.md"},"tag":"reference","children":["transformations"],"type":"node"},", you can implement ",{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.apply!"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":["apply!"],"type":"node"}],"type":"node"}," as an inplace version of ",{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.apply"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":["apply"],"type":"node"}],"type":"node"}," to support buffered transformations. Usually, the result of a regular ",{"attributes":{},"tag":"code","children":["apply"],"type":"node"}," can be used as a buffer. You may write"],"type":"node"},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"julia","children":[{"attributes":{},"tag":"EQ","children":[{"attributes":{},"tag":"IDENTIFIER","children":["buffer"],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"EQ","children":["="],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"CALL","children":[{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.apply"},"tag":"reference","children":["apply"],"type":"node"},{"attributes":{},"tag":"LPAREN","children":["("],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["tfm"],"type":"node"},{"attributes":{},"tag":"COMMA","children":[","],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["item"],"type":"node"},{"attributes":{},"tag":"RPAREN","children":[")"],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"NEWLINE_WS","children":["\n"],"type":"node"},{"attributes":{},"tag":"CALL","children":[{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.apply!"},"tag":"reference","children":["apply!"],"type":"node"},{"attributes":{},"tag":"LPAREN","children":["("],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["buffer"],"type":"node"},{"attributes":{},"tag":"COMMA","children":[","],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["tfm"],"type":"node"},{"attributes":{},"tag":"COMMA","children":[","],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["item"],"type":"node"},{"attributes":{},"tag":"RPAREN","children":[")"],"type":"node"}],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"p","children":["However, for some transformations, a different buffer is needed. ",{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.Sequence"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":["Sequence"],"type":"node"}],"type":"node"},", for example, needs to reuse all intermediate results. That is why the buffer creation can be customized:"],"type":"node"},{"attributes":{},"tag":"ul","children":[{"attributes":{},"tag":"li","children":[{"attributes":{},"tag":"p","children":[{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.makebuffer"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":["makebuffer"],"type":"node"}],"type":"node"},{"attributes":{},"tag":"code","children":["(tfm, item)"],"type":"node"}," creates a buffer ",{"attributes":{},"tag":"code","children":["buf"],"type":"node"}," that can be used in an ",{"attributes":{},"tag":"code","children":["apply!"],"type":"node"}," call: ",{"attributes":{},"tag":"code","children":["apply!(buf, tfm, item)"],"type":"node"},"."],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"hr","children":[],"type":"node"},{"attributes":{},"tag":"p","children":["Managing the buffers manually quickly becomes tedious. For convenience, this library implements ",{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.Buffered"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":["Buffered"],"type":"node"}],"type":"node"},", a transformation wrapper that will use a buffer internally. ",{"attributes":{},"tag":"code","children":["btfm = Buffered(tfm)"],"type":"node"}," will create a buffer the first time it is ",{"attributes":{},"tag":"code","children":["apply"],"type":"node"},"ed and then use it by internally calling ",{"attributes":{},"tag":"code","children":["apply!"],"type":"node"},"."],"type":"node"},{"attributes":{"lang":"julia"},"tag":"codeblock","children":[{"attributes":{},"tag":"julia","children":[{"attributes":{},"tag":"EQ","children":[{"attributes":{},"tag":"IDENTIFIER","children":["buffered"],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"EQ","children":["="],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"CALL","children":[{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.Buffered"},"tag":"reference","children":["Buffered"],"type":"node"},{"attributes":{},"tag":"LPAREN","children":["("],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["tfm"],"type":"node"},{"attributes":{},"tag":"RPAREN","children":[")"],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"NEWLINE_WS","children":["\n"],"type":"node"},{"attributes":{},"tag":"EQ","children":[{"attributes":{},"tag":"IDENTIFIER","children":["buffer"],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"EQ","children":["="],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"CALL","children":[{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.apply"},"tag":"reference","children":["apply"],"type":"node"},{"attributes":{},"tag":"LPAREN","children":["("],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["tfm"],"type":"node"},{"attributes":{},"tag":"COMMA","children":[","],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":[" "],"type":"node"},{"attributes":{},"tag":"IDENTIFIER","children":["item"],"type":"node"},{"attributes":{},"tag":"RPAREN","children":[")"],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"WHITESPACE","children":["  "],"type":"node"},{"attributes":{},"tag":"COMMENT","children":["# uses apply! internally"],"type":"node"}],"type":"node"}],"type":"node"},{"attributes":{},"tag":"p","children":["Since ",{"attributes":{},"tag":"code","children":["Buffered"],"type":"node"}," only stores one buffer, you may run into problems when using it in a multi-threading context where different threads invalidate the buffer before it can be used. In that case, you can use ",{"attributes":{"reftype":"symbol","document_id":"references/DataAugmentation.BufferedThreadsafe"},"tag":"reference","children":[{"attributes":{},"tag":"code","children":["BufferedThreadsafe"],"type":"node"}],"type":"node"},", a version of ",{"attributes":{},"tag":"code","children":["Buffered"],"type":"node"}," that keeps a separate buffer for every thread."],"type":"node"}],"type":"node"}],"type":"node"}