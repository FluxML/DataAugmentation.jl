<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="generator" content="Publish.jl" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="" />
    <title>DataAugmentation.jl</title>
    <link rel="stylesheet" href="..&#x2F;..&#x2F;normalize.css" />
    <link rel="stylesheet" href="..&#x2F;..&#x2F;tabulator_simple.min.css" />
    <link rel="stylesheet" href="..&#x2F;..&#x2F;lorenzo.css" />
    <script src="..&#x2F;..&#x2F;versions.js"></script>
    <script src="..&#x2F;..&#x2F;lunr.js"></script>
    <script src="..&#x2F;..&#x2F;highlight.min.js"></script>
    <script src="..&#x2F;..&#x2F;tabulator.min.js"></script>
    <script src="..&#x2F;..&#x2F;julia.min.js"></script>
    <script src="..&#x2F;..&#x2F;julia-repl.min.js"></script>
    <script src="..&#x2F;..&#x2F;publish.js"></script>
    
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital@1&family=Source+Sans+Pro:wght@700&display=swap" rel="stylesheet">
    <!-- 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
        -->

</head>
<body>
    <main id="page">
        <div class="menu">
            <div id="projectname">DataAugmentation.jl</div>
            <input id="search-input" placeholder="Search">
            <select id="version-selector"></select>
            <svg id="menu-toggler" title="Contents" onclick="toggleIndexPage();" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor" /><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor" /><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor" /></svg>
        </div>
        <div id="toc"><h2 id="dataaugmentationjl"><a href="../../#dataaugmentationjl" class="anchor"></a>DataAugmentation.jl</h2>
<table><thead><tr><th align="left"></th><th align="right"></th></tr></thead><tbody><tr><td align="left"><a href="../../docs/literate/intro.html">Introduction</a></td><td align="right"></td></tr><tr><td align="left"><a href="../../docs/literate/iteminterface.html">Item interface</a></td><td align="right"><a href="../../src/base.html"><code>base.jl</code></a></td></tr><tr><td align="left"><a href="../../docs/literate/tfminterface.html">Transformation interface</a></td><td align="right"><a href="../../src/base.html"><code>base.jl</code></a></td></tr><tr><td align="left"><a href="../../docs/literate/buffering.html">Buffering</a></td><td align="right"><a href="../../src/buffered.html"><code>buffered.jl</code></a></td></tr></tbody></table>
<h3 id="projective-transformations"><a href="../../#projective-transformations" class="anchor"></a>Projective transformations</h3>
<p>Augmenting spatial data like images and keypoints.</p>
<table><thead><tr><th align="left"></th><th align="right"></th></tr></thead><tbody><tr><td align="left"><a href="../../docs/literate/projective/intro.html">Introduction</a></td><td align="right"></td></tr><tr><td align="left"><a href="../../docs/literate/projective/interface.html">Interface</a></td><td align="right"><a href="../../src/projective/base.html"><code>projective/base.jl</code></a>           , <a href="../../src/projective/bounds.html"><code>projective/bounds.jl</code></a></td></tr><tr><td align="left"><a href="../../docs/literate/projective/data.html">Spatial data</a></td><td align="right"><a href="../../src/items/image.html"><code>items/image.jl</code></a>, <a href="../../src/items/mask.html"><code>items/mask.jl</code></a>, <a href="../../src/items/keypoints.html"><code>items/keypoints.jl</code></a></td></tr><tr><td align="left"><a href="../../docs/literate/projective/usage.html">Usage</a></td><td align="right"><a href="../../src/projective/compose.html"><code>projective/compose.jl</code></a>, <a href="../../src/projective/crop.html"><code>projective/crop.jl</code></a>, <a href="../../src/projective/affine.html"><code>projective/affine.jl</code></a></td></tr><tr><td align="left"><a href="../../docs/literate/projective/gallery.html">Gallery</a></td><td align="right"></td></tr></tbody></table>
<h3 id="preprocessing"><a href="../../#preprocessing" class="anchor"></a>Preprocessing</h3>
<p>Transformations for getting data in and out of a model.</p>
<table><thead><tr><th align="left"></th><th align="right"></th></tr></thead><tbody><tr><td align="left"><a href="../../docs/literate/preprocessing.html">Overview</a></td><td align="right"><a href="../../src/preprocessing.html"><code>preprocessing.jl</code></a></td></tr></tbody></table>
<p><a href="../../docstrings.html">Reference</a></p>
</div>
        <article><pre><code class="language-julia"></code></pre>
<h2 id="scaling"><a href="#scaling" class="anchor"></a>Scaling</h2>
<pre><code class="language-julia">function scaleprojection(ratios::NTuple{N}, T = Float32) where N
    a = zeros(Float32, N, N)
    a[I(N)] = SVector{N}(ratios)
    return LinearMap(SArray{Tuple{N, N}}(a))
end


struct ScaleRatio{N} &lt;: ProjectiveTransform
    ratios::NTuple{N}
end


function getprojection(scale::ScaleRatio, bounds; randstate = nothing)
    return scaleprojection(scale.ratios)
end

&quot;&quot;&quot;
    ScaleKeepAspect(minlengths)

Projective transformation that scales the shortest side of `item`
to `minlengths`, keeping the original aspect ratio.
&quot;&quot;&quot;
struct ScaleKeepAspect{N} &lt;: ProjectiveTransform
    minlengths::NTuple{N, Int}
end


function getprojection(scale::ScaleKeepAspect{N}, bounds; randstate = nothing) where N
    ratio = maximum(scale.minlengths ./ boundssize(bounds))
    return scaleprojection(Tuple(ratio for _ in 1:N))
end

&quot;&quot;&quot;
    ScaleFixed(sizes)

Projective transformation that scales sides to `sizes`, disregarding
aspect ratio.

See also [`ScaleKeepAspect`](#).
&quot;&quot;&quot;
struct ScaleFixed{N} &lt;: ProjectiveTransform
    sizes::NTuple{N, Int}
end


function getprojection(scale::ScaleFixed{N}, bounds; randstate = nothing) where N
    ratios = scale.sizes ./ boundssize(bounds)
    return scaleprojection(ratios)
end


&quot;&quot;&quot;
    Rotate(γ)

Rotate 2D spatial data by angle γ around the center.
&quot;&quot;&quot;
struct Rotate &lt;: ProjectiveTransform
    γ
end


function getprojection(rotate::Rotate, bounds; randstate = nothing)
    middlepoint = sum(bounds) ./ length(bounds)
    r = rotate.γ / 360 * 2pi
    return recenter(RotMatrix(r), middlepoint)
end


&quot;&quot;&quot;
    Reflect(γ)

Reflect 2D spatial data by angle γ around the center.
&quot;&quot;&quot;
struct Reflect &lt;: ProjectiveTransform
    γ
end


function getprojection(reflect::Reflect, bounds; randstate = nothing)
    middlepoint = sum(bounds) ./ length(bounds)
    r = reflect.γ / 360 * 2pi
    return recenter(reflectionmatrix(r), middlepoint)
end


FlipX() = Reflect(180)
FlipY() = Reflect(90)

reflectionmatrix(r) = SMatrix{2, 2, Float32}(cos(2r), sin(2r), sin(2r), -cos(2r))


&quot;&quot;&quot;
    PinOrigin()

Projective transformation that translates the data so that
the upper left bounding corner is at the origin `(0, 0)` (or
the multidimensional equivalent).

Projective transformations on images return `OffsetArray`s,
but not on keypoints. Hardware like GPUs do not support OffsetArrays,
so they will be unwrapped and no longer match up with the keypoints.

Pinning the data to the origin makes sure that the resulting
`OffsetArray` has the same indices as a regular array, starting
at one.
&quot;&quot;&quot;
struct PinOrigin &lt;: ProjectiveTransform end

function getprojection(::PinOrigin, bounds; randstate = nothing)
    return Translation(-bounds[1])
end

function apply(::PinOrigin, item::Union{Image, MaskMulti, MaskBinary}; randstate = nothing)
    item = @set item.data = parent(itemdata(item))
    item = @set item.bounds = makebounds(size(itemdata(item)))
    return item
end
</code></pre>
<p><code>PinOrigin</code> should not compose with a cropped transform otherwise the pinning won’t work.</p>
<pre><code class="language-julia">compose(cropped::CroppedProjectiveTransform, pin::PinOrigin) = Sequence(cropped, pin)
</code></pre>
<h2 id="resize-crops"><a href="#resize-crops" class="anchor"></a>Resize crops</h2>
<pre><code class="language-julia">RandomResizeCrop(sz) = ScaleKeepAspect(sz) |&gt; RandomCrop(sz) |&gt; PinOrigin()
CenterResizeCrop(sz) = ScaleKeepAspect(sz) |&gt; CenterCrop(sz) |&gt; PinOrigin()

ResizePadDivisible(sz, by) = ScaleKeepAspect(sz) |&gt; PadDivisible(by) |&gt; PinOrigin()
</code></pre>
</article>
        <div id="page-navigation">
            <a id="previous-page" title="Previous" href="crop.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.2426 6.34317L14.8284 4.92896L7.75739 12L14.8285 19.0711L16.2427 17.6569L10.5858 12L16.2426 6.34317Z" fill="currentColor" /></svg></a>
            <a id="next-page" title="Next" href="..&#x2F;..&#x2F;docs&#x2F;literate&#x2F;projective&#x2F;gallery.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5858 6.34317L12 4.92896L19.0711 12L12 19.0711L10.5858 17.6569L16.2427 12L10.5858 6.34317Z" fill="currentColor" /></svg></a>
        </div>
        <footer>
            Built with <a target="_blank" href="https://github.com/MichaelHatherly/Publish.jl">Publish.jl</a> and the <a target="_blank" href="https://julialang.org">Julia Language</a>.
        </footer>
    </main>
    <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
